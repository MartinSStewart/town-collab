module Ascii exposing
    ( Ascii(..)
    , charsPerRow
    , fromChar
    , image
    , size
    , textureData
    , textureHeight
    , texturePosition
    , texturePositionInt
    , textureWidth
    )

import Array exposing (Array)
import Base64
import Bounds exposing (Bounds)
import Dict exposing (Dict)
import Helper exposing (Coord)
import Image exposing (Image)
import Math.Vector2 exposing (Vec2)
import Pixels exposing (Pixels)
import Quantity exposing (Quantity)


charToAscii : Dict Char Ascii
charToAscii =
    Dict.fromList
        [ ( 'h', House )
        , ( 'r', RailHorizontal )
        , ( 'R', RailVertical )
        ]


fromChar : Char -> Maybe Ascii
fromChar char =
    Dict.get char charToAscii


size : ( Quantity number Pixels, Quantity number Pixels )
size =
    ( Pixels.pixels 18, Pixels.pixels 18 )


charsPerRow : number
charsPerRow =
    25


textureData : String
textureData =
    "data:image/png;base64,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eG1wdGs9IlhNUCBDb3JlIDQuNC4wLUV4aXYyIj4KIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgIHhtbG5zOmlwdGNFeHQ9Imh0dHA6Ly9pcHRjLm9yZy9zdGQvSXB0YzR4bXBFeHQvMjAwOC0wMi0yOS8iCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpwbHVzPSJodHRwOi8vbnMudXNlcGx1cy5vcmcvbGRmL3htcC8xLjAvIgogICAgeG1sbnM6R0lNUD0iaHR0cDovL3d3dy5naW1wLm9yZy94bXAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgIHhtcE1NOkRvY3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDo4MWEzYWQzMi1lNWFjLTQyZTgtYjZlYy02NGIzYzk2OThhOGMiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NWNkYjgyNjAtMTA3ZS00ZDc5LTkxODUtNGYxYzVlYmQxYmUzIgogICB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6NTgwMDcyZTItNmFhMS00NTU0LWFkNzgtNDZhNTc2ZGUzODc3IgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJXaW5kb3dzIgogICBHSU1QOlRpbWVTdGFtcD0iMTY2NTk1MTUxOTY3MzI2NiIKICAgR0lNUDpWZXJzaW9uPSIyLjEwLjIyIgogICBkYzpGb3JtYXQ9ImltYWdlL3BuZyIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8aXB0Y0V4dDpMb2NhdGlvbkNyZWF0ZWQ+CiAgICA8cmRmOkJhZy8+CiAgIDwvaXB0Y0V4dDpMb2NhdGlvbkNyZWF0ZWQ+CiAgIDxpcHRjRXh0OkxvY2F0aW9uU2hvd24+CiAgICA8cmRmOkJhZy8+CiAgIDwvaXB0Y0V4dDpMb2NhdGlvblNob3duPgogICA8aXB0Y0V4dDpBcnR3b3JrT3JPYmplY3Q+CiAgICA8cmRmOkJhZy8+CiAgIDwvaXB0Y0V4dDpBcnR3b3JrT3JPYmplY3Q+CiAgIDxpcHRjRXh0OlJlZ2lzdHJ5SWQ+CiAgICA8cmRmOkJhZy8+CiAgIDwvaXB0Y0V4dDpSZWdpc3RyeUlkPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5MTBkN2FkZC0xNDczLTQwZGYtOGZmMi0wMGNiYzBmMTkxMGUiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjItMTAtMTZUMjI6MTg6MzkiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogICA8cGx1czpJbWFnZVN1cHBsaWVyPgogICAgPHJkZjpTZXEvPgogICA8L3BsdXM6SW1hZ2VTdXBwbGllcj4KICAgPHBsdXM6SW1hZ2VDcmVhdG9yPgogICAgPHJkZjpTZXEvPgogICA8L3BsdXM6SW1hZ2VDcmVhdG9yPgogICA8cGx1czpDb3B5cmlnaHRPd25lcj4KICAgIDxyZGY6U2VxLz4KICAgPC9wbHVzOkNvcHlyaWdodE93bmVyPgogICA8cGx1czpMaWNlbnNvcj4KICAgIDxyZGY6U2VxLz4KICAgPC9wbHVzOkxpY2Vuc29yPgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+uUdIoQAAAAZiS0dEAP8AAAAAMyd88wAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+YKEBQSJ9Cx0xUAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEeElEQVR42u3dP2sTYRwH8OeODh0EXczq4kvo6GLxRQh1CA4nrin0RQjtWnpD6SK4+QaKXRzFV+DiZFvBVhDTQXMOtaVcmzR/7q55Lp8PFEIuPXIJv+/z+z0JJISabHZXi1mOA/VL6jjpdm+tOPv5PSw/6IQkSa8dL4pBODs9Dsv3H4bXW28TbwPcjaU6Tto/PQrFYBD6J4dDMqY4P3565B2ANjICQCQjwM5Gt/h1/DWs7x0ks9w2AkBkAbDZfVrJSnw1ALZePiuKwSAkaTpyBEjSNPR29wUA3KWdjW5xEQSz3DYCQFxq2QS8GAG2118Uo0aA7d5aYQSAlgWATwFggQOgt7ufbHZXi1Hz/W3HASMAYAQAjABApWr5HoAvAkEc0vW9g+Re59FlEU97uzwCDP7+Cf2Tw/D7x7drf/2Tw/PjRgBoJ18EgghGgDpOagSAOPgUABa5A9jZ6F624q/e7EW9GrfpWqDxonFNsFhSLwFQueN3j63CMO97AHUXf+f5F7M4LMoIcFn8uU4AWtkBDFvhy8UfQggh0wlA6zuAG4tfJwDtD4ChxS8EoN0jQLnIRzIOQAtHgHyyx+kEoC0BkE/3eCEAsQdAPtv/CQGIbA/g1g2/SdgTgHgCoNLiFwIQTwDUUvxCAOY/AGot/lIIXBAGMAcB0EjxDwmBMqEADQZAo8U/YRgIBWhqBFidk4/rdAhQqaWonm0+facANB0AWQPjw//zdz5Y/WFSaa3Fb4WGBewAsiurczZFJzBpaOTeSKg/ALIxii8r3X9TCGRjFHI+w3MCauoA8hHFlw0p3ptCIFfI0K49gHzG40DEAQC0fASoqlXX8kNkAVBVC28UACMAcMcdwFi/pPvp49xfSPk6/Dw46ACAWfcA3q88Gf+Mn0MIKxPcHxp8LKADAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADMoX9L88SBoR9f8AAAAABJRU5ErkJggg=="


image : Array (Array Image.Pixel)
image =
    String.dropLeft (String.length "data:image/png;base64,") textureData
        |> Base64.toBytes
        |> Maybe.andThen Image.decode
        |> Maybe.withDefault (Image.fromList2d [])
        |> Image.toArray2d
        |> Array.map
            (Array.map
                (\pixel ->
                    if pixel + 1 == 0 then
                        255

                    else
                        -1
                )
            )


textureWidth : Quantity number Pixels
textureWidth =
    Pixels.pixels 256


textureHeight : Quantity number Pixels
textureHeight =
    Pixels.pixels 512


type Ascii
    = House
    | RailHorizontal
    | RailVertical


texturePosition : Ascii -> { topLeft : Vec2, bottomRight : Vec2 }
texturePosition ascii =
    let
        ( Quantity.Quantity tileW, Quantity.Quantity tileH ) =
            size

        ( ( x, y ), ( w, h ) ) =
            data ascii
    in
    { topLeft = Math.Vector2.vec2 (x * tileW) (y * tileH)
    , bottomRight = Math.Vector2.vec2 ((x + w) * tileW) ((y + h) * tileH)
    }


data ascii =
    case ascii of
        House ->
            ( ( 0, 1 ), ( 3, 2 ) )

        RailHorizontal ->
            ( ( 0, 0 ), ( 1, 1 ) )

        RailVertical ->
            ( ( 1, 0 ), ( 1, 1 ) )


texturePositionInt : Ascii -> Bounds Pixels
texturePositionInt ascii =
    let
        ( Quantity.Quantity tileW, Quantity.Quantity tileH ) =
            size

        ( ( x, y ), ( w, h ) ) =
            data ascii
    in
    Bounds.bounds
        (Helper.fromRawCoord
            ( x * tileW
            , y * tileH
            )
        )
        (Helper.fromRawCoord
            ( (x + w) * tileW
            , (y + h) * tileH
            )
        )
